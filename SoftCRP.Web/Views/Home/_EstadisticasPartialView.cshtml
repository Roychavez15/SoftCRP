@using SoftCRP.Web.Repositories
@inject IAccesosRepository AccesosRep

@model SoftCRP.Web.Models.EstadisticasViewModel

@{
    ViewData["Title"] = "Estadisticas";
}


@if (User.Identity.IsAuthenticated && User.IsInRole("Cliente"))
{
    var accceso2 = await AccesosRep.GetAcceso(User.Identity.Name);
    if (accceso2 != null)
    {
        <div class="row">
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-gradient-gray">
                    <div class="inner">
                        <h3>@Model.EstadisticasV1ViewModel.TotalAutos</h3>

                        <p>Flota</p>
                    </div>
                    <div class="icon">
                        <i class="fa fa-car"></i>
                    </div>
                    @*<a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>*@
                    <a asp-area="" class="small-box-footer" asp-controller="Informacion" asp-action="Index">
                        Mas Información <i class="fas fa-arrow-circle-right"></i>
                    </a>
                </div>
            </div>
            @if (accceso2.Analisis && accceso2.Tramites)
            {
                <!-- ./col -->
                <div class="col-lg-3 col-6">
                    <!-- small box -->
                    <div class="small-box bg-gradient-gray">
                        <div class="inner">
                            <h3>@Model.EstadisticasV1ViewModel.Transacciones</h3>

                            <p>Transacciones Subidas</p>
                        </div>
                        <div class="icon">
                            <i class="ion ion-stats-bars"></i>
                        </div>
                        @*<a asp-area="" class="small-box-footer" asp-controller="Tramites" asp-action="Index">
                                Mas Información <i class="fas fa-arrow-circle-right"></i>
                            </a>*@
                        <a asp-area="" class="small-box-footer">
                            @Model.EstadisticasV1ViewModel.Analisis Análisis - @Model.EstadisticasV1ViewModel.Tramite Trámites
                        </a>
                    </div>
                </div>
                <!-- ./col -->
            }

            @if (accceso2.Seguimiento)
            {
                <div class="col-lg-3 col-6">
                    <!-- small box -->
                    <div class="small-box bg-gradient-gray">
                        <div class="inner">
                            <h3>@Model.EstadisticasV1ViewModel.novedad</h3>

                            <p>Novedades sin solución</p>
                        </div>
                        <div class="icon">
                            <i class="ion ion-person-add"></i>
                        </div>
                        <a asp-area="" class="small-box-footer" asp-controller="Novedades" asp-action="Index">
                            Mas Información <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                <!-- ./col -->
            }

            @if (accceso2.Capacitaciones)
            {
                <div class="col-lg-3 col-6">
                    <!-- small box -->
                    <div class="small-box bg-gradient-gray">
                        <div class="inner">
                            <h3>@Model.EstadisticasV1ViewModel.Capacitaciones</h3>

                            <p>Capacitaciones</p>
                        </div>
                        <div class="icon">
                            <i class="ion ion-pie-graph"></i>
                        </div>
                        <a asp-area="" class="small-box-footer" asp-controller="Capacitaciones" asp-action="Index">
                            Mas Información <i class="fas fa-arrow-circle-right"></i>
                        </a>

                    </div>
                </div>
                <!-- ./col -->
            }
        </div>
    }

}

else if (User.Identity.IsAuthenticated && (User.IsInRole("Admin") || User.IsInRole("Renting")))
{
    <!-- Small boxes (Stat box) -->
    <div class="row">
        <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-gradient-gray">
                <div class="inner">
                    <h3>@Model.EstadisticasV1ViewModel.TotalAutos</h3>

                    <p>Flota</p>
                </div>
                <div class="icon">
                    <i class="fa fa-car"></i>
                </div>
                @*<a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>*@
                <a asp-area="" class="small-box-footer" asp-controller="Informacion" asp-action="Index">
                    Mas Información <i class="fas fa-arrow-circle-right"></i>
                </a>
            </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-gradient-gray">
                <div class="inner">
                    <h3>@Model.EstadisticasV1ViewModel.Transacciones</h3>

                    <p>Transacciones Subidas</p>
                </div>
                <div class="icon">
                    <i class="ion ion-stats-bars"></i>
                </div>
                @*<a asp-area="" class="small-box-footer" asp-controller="Tramites" asp-action="Index">
                        Mas Información <i class="fas fa-arrow-circle-right"></i>
                    </a>*@
                <a asp-area="" class="small-box-footer">
                    @Model.EstadisticasV1ViewModel.Analisis Análisis - @Model.EstadisticasV1ViewModel.Tramite Trámites
                </a>
            </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-gradient-gray">
                <div class="inner">
                    <h3>@Model.EstadisticasV1ViewModel.novedad</h3>

                    <p>Novedades sin solución</p>
                </div>
                <div class="icon">
                    <i class="ion ion-person-add"></i>
                </div>
                <a asp-area="" class="small-box-footer" asp-controller="Novedades" asp-action="Index">
                    Mas Información <i class="fas fa-arrow-circle-right"></i>
                </a>
            </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-gradient-gray">
                <div class="inner">
                    <h3>@Model.EstadisticasV1ViewModel.Capacitaciones</h3>

                    <p>Capacitaciones</p>
                </div>
                <div class="icon">
                    <i class="ion ion-pie-graph"></i>
                </div>
                <a asp-area="" class="small-box-footer" asp-controller="Capacitaciones" asp-action="Index">
                    Mas Información <i class="fas fa-arrow-circle-right"></i>
                </a>

            </div>
        </div>
        <!-- ./col -->
    </div>
    <!-- /.row -->
}



@if (Model.EstadisticasV2ViewModel.vehiculosGps == null)
{

    <h2> No existen Datos de GPS</h2>
}
else
{
    @if (User.Identity.IsAuthenticated && User.IsInRole("Cliente"))
    {
        var accceso1 = await AccesosRep.GetAcceso(User.Identity.Name);
        if (accceso1 != null)
        {
            <div class="row mb-3">

                @if (accceso1.Graficos)
                {
                    <div class="col-lg-3 col-6">
                        <div class="small-box bg-gradient-gray">
                            <div class="inner">
                                <h3>@Model.EstadisticasV2ViewModel.vehiculos.ToList().Count</h3>

                                <p>Dispositivos Instalados</p>
                            </div>
                            <div class="icon">
                                <i class="fas fa-globe"></i>
                            </div>

                        </div>
                    </div>
                }

                @if (accceso1.Conduccion)
                {
                    <div class="col-lg-3 col-6">
                        <div class="small-box bg-gradient-gray">
                            <div class="inner">
                                <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(u => u.conductores)</h3>

                                <p>Cantidad de Usuarios</p>
                            </div>
                            <div class="icon">
                                <i class="fa fa-users"></i>
                            </div>

                        </div>
                    </div>
                    <div class="col-lg-3 col-6">
                        <div class="small-box bg-gradient-gray">
                            <div class="inner">
                                <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(t => t.trips)</h3>

                                <p>Cantidad de Viajes</p>
                            </div>
                            <div class="icon">
                                <i class="fa fa-map-marked-alt"></i>
                            </div>

                        </div>
                    </div>

                    <div class="col-lg-3 col-6">
                        <div class="small-box bg-gradient-gray">
                            <div class="inner">
                                <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(t => t.kilometerstraveled)</h3>

                                <p>Distancia Recorrida (Km)</p>
                            </div>
                            <div class="icon">
                                <i class="fa fa-route"></i>
                            </div>

                        </div>
                    </div>


                }

            </div>
            <!-- /.row -->
            <div class="row">
                @if (accceso1.Mantenimiento)
                {
                    <div class="col-lg-3 col-6">

                        <div class="small-box bg-gradient-gray">
                            <div class="inner">
                                <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(t => t.talleres)</h3>

                                <p>Ingresos a Taller</p>
                            </div>
                            <div class="icon">
                                <i class="fa fa-wrench"></i>
                            </div>

                        </div>
                    </div>
                }

                @if (accceso1.Sustitutos)
                {
                    <div class="col-lg-3 col-6">
                        <div class="small-box bg-gradient-gray">
                            <div class="inner">
                                <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(t => t.ahorro)</h3>

                                <p>Ahorro en sustitución</p>
                            </div>
                            <div class="icon">
                                <i class="fa fa-money-check-alt"></i>
                            </div>

                        </div>
                    </div>
                }

                @if (accceso1.Siniestros)
                {
                    <div class="col-lg-3 col-6">
                        <div class="small-box bg-gradient-gray">
                            <div class="inner">
                                <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(t => t.siniestros)</h3>

                                <p>Total Siniestros</p>
                            </div>
                            <div class="icon">
                                <i class="fa fa-car-crash"></i>
                            </div>

                        </div>
                    </div>
                }

                @if (accceso1.Conduccion)
                {
                    <div class="col-lg-3 col-6">
                        <div class="small-box bg-gradient-gray">
                            <div class="inner">
                                <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(t => t.speeding)</h3>

                                <p>Limites de velocidad</p>
                            </div>
                            <div class="icon">
                                <i class="fa fa-tachometer-alt"></i>
                            </div>

                        </div>
                    </div>
                }

            </div>
            <!-- /.row -->

            <div class="row">
                @if (accceso1.Conduccion)
                {
                    <div class="col-lg-3 col-6">
                        <div class="small-box bg-gradient-gray">
                            <div class="inner">
                                <h3>@String.Format("{0:N2}", Model.EstadisticasV2ViewModel.vehiculosGps?.Average(s => s.score))</h3>

                                <p>Promedio de calificación</p>
                            </div>
                            <div class="icon">
                                <i class="fa fa-sort-numeric-up-alt"></i>
                            </div>

                        </div>
                    </div>
                }

            </div>
            <!-- /.row -->

        }

    }
    else if (User.Identity.IsAuthenticated && (User.IsInRole("Admin") || User.IsInRole("Renting"))) //si es admini
    {
        <div class="row mb-3">
            <div class="col-lg-3 col-6">
                <div class="small-box bg-gradient-gray">
                    <div class="inner">
                        <h3>@Model.EstadisticasV2ViewModel.vehiculos.ToList().Count</h3>

                        <p>Dispositivos Instalados</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-globe"></i>
                    </div>

                </div>
            </div>

            <div class="col-lg-3 col-6">
                <div class="small-box bg-gradient-gray">
                    <div class="inner">
                        <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(u => u.conductores)</h3>

                        <p>Cantidad de Usuarios</p>
                    </div>
                    <div class="icon">
                        <i class="fa fa-users"></i>
                    </div>

                </div>
            </div>

            <div class="col-lg-3 col-6">
                <div class="small-box bg-gradient-gray">
                    <div class="inner">
                        <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(t => t.trips)</h3>

                        <p>Cantidad de Viajes</p>
                    </div>
                    <div class="icon">
                        <i class="fa fa-map-marked-alt"></i>
                    </div>

                </div>
            </div>

            <div class="col-lg-3 col-6">
                <div class="small-box bg-gradient-gray">
                    <div class="inner">
                        <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(t => t.kilometerstraveled)</h3>

                        <p>Distancia Recorrida (Km)</p>
                    </div>
                    <div class="icon">
                        <i class="fa fa-route"></i>
                    </div>

                </div>
            </div>
        </div>
        <!-- /.row -->

        <div class="row">
            <div class="col-lg-3 col-6">

                <div class="small-box bg-gradient-gray">
                    <div class="inner">
                        <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(t => t.talleres)</h3>

                        <p>Ingresos a Taller</p>
                    </div>
                    <div class="icon">
                        <i class="fa fa-wrench"></i>
                    </div>

                </div>
            </div>

            <div class="col-lg-3 col-6">
                <div class="small-box bg-gradient-gray">
                    <div class="inner">
                        <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(t => t.ahorro)</h3>

                        <p>Ahorro en sustitución</p>
                    </div>
                    <div class="icon">
                        <i class="fa fa-money-check-alt"></i>
                    </div>

                </div>
            </div>

            <div class="col-lg-3 col-6">
                <div class="small-box bg-gradient-gray">
                    <div class="inner">
                        <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(t => t.siniestros)</h3>

                        <p>Total Siniestros</p>
                    </div>
                    <div class="icon">
                        <i class="fa fa-car-crash"></i>
                    </div>

                </div>
            </div>

            <div class="col-lg-3 col-6">
                <div class="small-box bg-gradient-gray">
                    <div class="inner">
                        <h3>@Model.EstadisticasV2ViewModel.vehiculosGps.Sum(t => t.speeding)</h3>

                        <p>Limites de velocidad</p>
                    </div>
                    <div class="icon">
                        <i class="fa fa-tachometer-alt"></i>
                    </div>

                </div>
            </div>
        </div>
        <!-- /.row -->

        <div class="row">
            <div class="col-lg-3 col-6">
                <div class="small-box bg-gradient-gray">
                    <div class="inner">
                        <h3>@String.Format("{0:N2}", Model.EstadisticasV2ViewModel.vehiculosGps?.Average(s => s.score))</h3>

                        <p>Promedio de calificación</p>
                    </div>
                    <div class="icon">
                        <i class="fa fa-sort-numeric-up-alt"></i>
                    </div>

                </div>
            </div>
        </div>
        <!-- /.row -->
    }
}